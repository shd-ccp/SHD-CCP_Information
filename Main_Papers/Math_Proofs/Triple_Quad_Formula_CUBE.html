<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Triple Quad Formula — Interactive Learning</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&family=Instrument+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #111118;
    --surface2: #1a1a26;
    --border: #2a2a3a;
    --text: #e8e8f0;
    --muted: #6a6a88;
    --accent-violet: #c084fc;
    --accent-red: #f87171;
    --accent-blue: #60a5fa;
    --accent-green: #4ade80;
    --accent-gold: #fbbf24;
    --accent-orange: #fb923c;
    --plot-bg: #0d0d16;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Instrument Sans', sans-serif;
    font-size: 16px;
    line-height: 1.7;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(192,132,252,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(192,132,252,0.03) 1px, transparent 1px);
    background-size: 48px 48px;
    pointer-events: none;
    z-index: 0;
  }

  .page-wrapper {
    position: relative;
    z-index: 1;
    max-width: 920px;
    margin: 0 auto;
    padding: 0 24px 100px;
  }

  /* ── HEADER ── */
  header {
    padding: 64px 0 48px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 60px;
    animation: fadeUp 0.7s ease both;
  }

  .meta-bar {
    display: flex;
    gap: 12px;
    align-items: center;
    margin-bottom: 28px;
    flex-wrap: wrap;
  }

  .tag {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    padding: 4px 10px;
    border-radius: 3px;
    border: 1px solid;
  }
  .tag-violet { color: var(--accent-violet); border-color: rgba(192,132,252,0.3); background: rgba(192,132,252,0.06); }
  .tag-green  { color: var(--accent-green);  border-color: rgba(74,222,128,0.3);  background: rgba(74,222,128,0.06); }
  .tag-gold   { color: var(--accent-gold);   border-color: rgba(251,191,36,0.3);  background: rgba(251,191,36,0.06); }
  .tag-blue   { color: var(--accent-blue);   border-color: rgba(96,165,250,0.3);  background: rgba(96,165,250,0.06); }

  h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(2rem, 5vw, 3.4rem);
    font-weight: 400;
    line-height: 1.1;
    color: #fff;
    letter-spacing: -0.02em;
    margin-bottom: 16px;
  }
  h1 em { font-style: italic; color: var(--accent-violet); }

  .subtitle {
    font-size: 15px;
    color: var(--muted);
    font-weight: 300;
    max-width: 580px;
    line-height: 1.7;
  }

  .source-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-top: 18px;
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    text-decoration: none;
    transition: color 0.2s;
  }
  .source-link:hover { color: var(--accent-violet); }
  .source-link::before { content: '↗ '; }

  /* ── STATEMENT ── */
  .statement-block {
    background: var(--surface);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent-violet);
    border-radius: 8px;
    padding: 28px 32px;
    margin-bottom: 48px;
    position: relative;
    overflow: hidden;
  }
  .statement-block::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; height: 1px;
    background: linear-gradient(90deg, var(--accent-violet), transparent);
  }
  .statement-block h2 {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    color: var(--accent-violet);
    margin-bottom: 10px;
  }
  .statement-block p { color: #ccc; font-size: 15px; line-height: 1.8; }

  /* ── CORE FORMULA ── */
  .formula-hero {
    background: #0d0d16;
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 28px 32px;
    margin: 24px 0;
    text-align: center;
    font-family: 'DM Mono', monospace;
    font-size: clamp(1rem, 2.5vw, 1.35rem);
    color: #fff;
    letter-spacing: 0.04em;
    position: relative;
    overflow: hidden;
  }
  .formula-hero::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(ellipse at 50% 0%, rgba(192,132,252,0.1), transparent 60%);
    pointer-events: none;
  }
  .formula-hero .eq-label {
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 0.12em;
    text-transform: uppercase;
    display: block;
    margin-bottom: 10px;
  }

  hr.divider { border: none; border-top: 1px solid var(--border); margin: 52px 0; }

  /* ── SECTION ── */
  .section { margin-bottom: 64px; }

  .section-header {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    margin-bottom: 8px;
  }

  .step-number {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 4px 10px;
    border-radius: 4px;
    margin-top: 6px;
    white-space: nowrap;
  }

  .section-title {
    font-family: 'DM Serif Display', serif;
    font-size: 1.75rem;
    font-weight: 400;
    color: #fff;
    line-height: 1.2;
  }

  .section-sub {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 20px;
    padding-left: calc(10px + 10px + 16px + 10px); /* align under title */
  }

  .body-text { color: #bbb; font-size: 15px; line-height: 1.8; margin-bottom: 20px; }
  .body-text strong { color: #ddd; }

  /* ── PLOTLY CONTAINER ── */
  .viz-card {
    background: var(--plot-bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 4px;
    margin: 28px 0;
    position: relative;
    overflow: hidden;
  }
  .viz-card::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; height: 1px;
    background: linear-gradient(90deg, transparent, rgba(192,132,252,0.3), transparent);
    pointer-events: none;
  }
  .viz-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px 0 16px;
    gap: 10px;
  }
  .viz-label {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 0.12em;
    text-transform: uppercase;
  }
  .viz-reset {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 3px 10px;
    cursor: pointer;
    white-space: nowrap;
    transition: color 0.15s, border-color 0.15s, background 0.15s;
    flex-shrink: 0;
  }
  .viz-reset:hover {
    color: var(--accent-violet);
    border-color: rgba(192,132,252,0.4);
    background: rgba(192,132,252,0.07);
  }
  .viz-reset:active {
    transform: scale(0.96);
  }
  .viz-caption {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    padding: 6px 16px 12px;
    line-height: 1.5;
  }

  /* ── SLIDER ── */
  .slider-wrapper {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 24px 28px;
    margin: 24px 0;
  }
  .slider-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
    flex-wrap: wrap;
    gap: 8px;
  }
  .slider-top label {
    font-family: 'DM Mono', monospace;
    font-size: 13px;
    color: #ccc;
  }
  .slider-top label span { color: var(--accent-orange); font-size: 16px; }
  .k-display {
    font-family: 'DM Mono', monospace;
    font-size: 22px;
    color: var(--accent-orange);
    min-width: 48px;
    text-align: right;
  }

  input[type=range] {
    width: 100%;
    -webkit-appearance: none;
    background: transparent;
    cursor: pointer;
    margin: 8px 0 20px;
  }
  input[type=range]::-webkit-slider-runnable-track {
    height: 3px;
    background: linear-gradient(90deg, var(--accent-violet), var(--accent-orange));
    border-radius: 2px;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px; height: 18px;
    background: var(--accent-orange);
    border-radius: 50%;
    margin-top: -7.5px;
    box-shadow: 0 0 12px rgba(251,146,60,0.5);
    transition: box-shadow 0.2s;
  }
  input[type=range]:hover::-webkit-slider-thumb { box-shadow: 0 0 20px rgba(251,146,60,0.8); }
  input[type=range]::-moz-range-track {
    height: 3px;
    background: linear-gradient(90deg, var(--accent-violet), var(--accent-orange));
    border-radius: 2px;
  }
  input[type=range]::-moz-range-thumb {
    width: 18px; height: 18px;
    background: var(--accent-orange);
    border: none;
    border-radius: 50%;
  }

  .q-readout {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 4px;
  }
  .q-val {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 12px 14px;
    text-align: center;
    font-family: 'DM Mono', monospace;
  }
  .q-val .q-name { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 4px; }
  .q-val .q-num  { font-size: 20px; color: #fff; }
  .q-val.qv1 .q-num { color: #a3e635; }
  .q-val.qv2 .q-num { color: var(--accent-gold); }
  .q-val.qv3 .q-num { color: #a78bfa; }

  .tqf-check {
    margin-top: 16px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 14px 18px;
    font-family: 'DM Mono', monospace;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }
  .tqf-check .lhs { color: #a3e635; }
  .tqf-check .rhs { color: #a78bfa; }
  .tqf-check .eq-sign { color: var(--muted); }
  .tqf-check .status { margin-left: auto; font-size: 11px; letter-spacing: 0.1em; text-transform: uppercase; }
  .tqf-check .status.ok  { color: var(--accent-green); }
  .tqf-check .status.bad { color: var(--accent-red); }

  /* ── POINTS GRID ── */
  .points-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
    margin: 24px 0;
  }
  .point-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 18px 16px;
    text-align: center;
    transition: transform 0.2s;
  }
  .point-card:hover { transform: translateY(-2px); }
  .point-card.p1 { border-top: 2px solid var(--accent-red); }
  .point-card.p2 { border-top: 2px solid var(--accent-blue); }
  .point-card.p3 { border-top: 2px solid var(--accent-green); }
  .point-card .pt-label { font-family: 'DM Mono', monospace; font-size: 20px; font-weight: 500; margin-bottom: 6px; }
  .point-card.p1 .pt-label { color: var(--accent-red); }
  .point-card.p2 .pt-label { color: var(--accent-blue); }
  .point-card.p3 .pt-label { color: var(--accent-green); }
  .point-card .pt-coords { font-family: 'DM Mono', monospace; font-size: 12px; color: var(--muted); }

  /* ── PARAM BLOCK ── */
  .param-block {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 20px 24px;
    margin: 20px 0;
  }
  .param-row {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 9px 0;
    border-bottom: 1px solid rgba(42,42,58,0.7);
    font-family: 'DM Mono', monospace;
    font-size: 14px;
  }
  .param-row:last-child { border-bottom: none; }
  .pr-label { color: var(--muted); width: 50px; font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em; }
  .r { color: var(--accent-red); }
  .b { color: var(--accent-blue); }
  .g { color: var(--accent-green); }
  .v { color: var(--accent-violet); }
  .o { color: var(--accent-orange); }

  /* ── DEF CARD ── */
  .def-card {
    background: linear-gradient(135deg, #111120, #0d0d1a);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 28px 32px;
    margin: 24px 0;
  }
  .def-term {
    font-family: 'DM Serif Display', serif;
    font-size: 1.9rem;
    color: var(--accent-violet);
    font-style: italic;
    margin-bottom: 12px;
  }
  .def-card p { color: #bbb; font-size: 15px; line-height: 1.8; }
  .inline-formula {
    margin: 16px 0 4px;
    font-family: 'DM Mono', monospace;
    font-size: 1.05rem;
    color: #fff;
    padding: 14px 18px;
    background: rgba(0,0,0,0.4);
    border-radius: 6px;
    border-left: 3px solid var(--accent-violet);
  }

  /* ── Q TABLE ── */
  .q-table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    font-family: 'DM Mono', monospace;
    font-size: 13px;
  }
  .q-table th {
    background: var(--surface2);
    color: var(--muted);
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding: 10px 16px;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }
  .q-table td { padding: 13px 16px; border-bottom: 1px solid rgba(42,42,58,0.5); }
  .q-table tr:hover td { background: rgba(255,255,255,0.02); }
  .qn { font-size: 15px; font-weight: 500; }
  .qn.q1 { color: #a3e635; }
  .qn.q2 { color: var(--accent-gold); }
  .qn.q3 { color: #a78bfa; }

  /* ── PROOF STEPS ── */
  .proof-steps { margin: 20px 0; }
  .proof-step {
    display: grid;
    grid-template-columns: 72px 1fr;
    margin-bottom: 2px;
  }
  .ps-label {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-right: none;
    border-radius: 6px 0 0 6px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 12px 6px;
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    text-align: center;
  }
  .ps-body {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 0 6px 6px 0;
    padding: 12px 18px;
    font-family: 'DM Mono', monospace;
    font-size: 14px;
    color: #ddd;
  }
  .ps-body .ps-comment { color: var(--muted); font-size: 12px; margin-top: 3px; }

  /* ── RESULT BANNER ── */
  .result-banner {
    background: linear-gradient(135deg, rgba(192,132,252,0.1), rgba(96,165,250,0.07));
    border: 1px solid rgba(192,132,252,0.25);
    border-radius: 10px;
    padding: 28px 32px;
    margin: 32px 0;
    text-align: center;
  }
  .result-banner .res-label {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    color: var(--accent-violet);
    margin-bottom: 10px;
  }
  .result-banner .res-text {
    font-family: 'DM Serif Display', serif;
    font-size: 1.3rem;
    color: #fff;
    line-height: 1.4;
  }
  .result-banner .res-eq {
    font-family: 'DM Mono', monospace;
    font-size: 1.2rem;
    color: var(--accent-violet);
    margin-top: 14px;
  }

  /* ── APP GRID ── */
  .app-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 14px;
    margin: 24px 0;
  }
  .app-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 18px 20px;
  }
  .app-card h4 {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--muted);
    margin-bottom: 6px;
  }
  .app-card .app-val {
    font-family: 'DM Mono', monospace;
    font-size: 22px;
    color: #fff;
    margin-bottom: 4px;
  }
  .app-card p { font-size: 13px; color: #888; line-height: 1.5; }

  /* ── REFS ── */
  .refs {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 24px 28px;
    margin-top: 48px;
  }
  .refs h3 {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--muted);
    margin-bottom: 16px;
  }
  .refs a {
    display: block;
    color: #999;
    font-size: 13px;
    text-decoration: none;
    padding: 9px 0;
    border-bottom: 1px solid var(--border);
    transition: color 0.2s;
  }
  .refs a:last-child { border-bottom: none; }
  .refs a:hover { color: var(--accent-violet); }
  .refs a::before { content: '→ '; color: var(--muted); }

  /* ── DISTANCE COMPARISON TOGGLE ── */
  .compare-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin: 20px 0;
  }
  .compare-col {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 18px 20px;
    text-align: center;
  }
  .compare-col .cc-label {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    margin-bottom: 10px;
  }
  .compare-col.col-dist .cc-label { color: var(--accent-red); }
  .compare-col.col-quad .cc-label { color: var(--accent-violet); }
  .compare-col .cc-val {
    font-family: 'DM Mono', monospace;
    font-size: 1.2rem;
    color: #fff;
    margin: 6px 0;
  }
  .compare-col .cc-note { font-size: 12px; color: var(--muted); }
  .cc-irrational { color: var(--accent-red) !important; }
  .cc-rational   { color: var(--accent-green) !important; }

  /* ── ANIMATIONS ── */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(18px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  .section { animation: fadeUp 0.5s ease both; }
  .section:nth-child(1){ animation-delay:0.05s; }
  .section:nth-child(2){ animation-delay:0.12s; }
  .section:nth-child(3){ animation-delay:0.18s; }
  .section:nth-child(4){ animation-delay:0.24s; }
  .section:nth-child(5){ animation-delay:0.30s; }
  .section:nth-child(6){ animation-delay:0.36s; }

  /* ── RESPONSIVE ── */
  @media(max-width:600px){
    .points-grid, .app-grid, .compare-grid { grid-template-columns: 1fr; }
    .q-readout { grid-template-columns: 1fr; }
    .proof-step { grid-template-columns: 56px 1fr; }
  }

  /* scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
</style>
</head>
<body>
<div class="page-wrapper">

<!-- ════════════════ HEADER ════════════════ -->
<header>
  <div class="meta-bar">
    <span class="tag tag-violet">Rational Trigonometry</span>
    <span class="tag tag-blue">Interactive Learning</span>
    <span class="tag tag-green">Open Review</span>
    <span class="tag tag-gold">Schism Labs</span>
  </div>
  <h1>Triple Quad Formula<br>for a <em>4×4×4</em> Cube</h1>
  <p class="subtitle">An interactive derivation extending the Triple Quad Formula from 1D affine space into 3D — applied to a discrete lattice grid. Drag, rotate, and explore each step.</p>
  <a class="source-link" href="https://independent.academia.edu/GHoard" target="_blank">Formal proof: independent.academia.edu/GHoard</a>
</header>

<!-- ════════════════ STATEMENT ════════════════ -->
<div class="statement-block">
  <h2>Statement</h2>
  <p>The Triple Quad Formula (TQF) asserts that for three collinear points, the Archimedes function of their quadrances is zero. The goal is to extend this relation from 1D affine space into 3D affine space — specifically applied to a discrete 4×4×4 lattice grid.</p>
</div>

<div class="formula-hero">
  <span class="eq-label">The Triple Quad Formula</span>
  (Q₁ + Q₂ + Q₃)² = 2(Q₁² + Q₂² + Q₃²)
</div>

<hr class="divider">

<!-- ════════════════ STEP 0: 3D SETUP ════════════════ -->
<div class="section">
  <div class="section-header">
    <span class="step-number">Step 0</span>
    <div class="section-title">Three Collinear Points in 3D</div>
  </div>
  <div class="section-sub">Setting up the geometry — defining the line</div>

  <p class="body-text">
    We begin with three points A₁, A₂, A₃ in 3D Euclidean space. For the TQF to apply, they must be <strong>collinear</strong> — lying on a single line. We parameterize this line using a direction vector <span class="v"><strong>v = (dx, dy, dz)</strong></span> and a scalar <span class="o"><strong>k</strong></span>.
  </p>

  <div class="points-grid">
    <div class="point-card p1">
      <div class="pt-label">A₁</div>
      <div class="pt-coords">(x₁, y₁, z₁)</div>
    </div>
    <div class="point-card p2">
      <div class="pt-label">A₂</div>
      <div class="pt-coords">(x₂, y₂, z₂)</div>
    </div>
    <div class="point-card p3">
      <div class="pt-label">A₃</div>
      <div class="pt-coords">(x₃, y₃, z₃)</div>
    </div>
  </div>

  <div class="param-block">
    <div class="param-row">
      <span class="pr-label">Let</span>
      <span><span class="b">A₂</span> = <span class="r">A₁</span> + <span class="v">v</span></span>
    </div>
    <div class="param-row">
      <span class="pr-label">And</span>
      <span><span class="g">A₃</span> = <span class="r">A₁</span> + <span class="o">k</span><span class="v">v</span></span>
    </div>
  </div>
  <p class="body-text" style="font-size:13px; font-style:italic;">
    where <span class="o">k</span> is a scalar representing the position of A₃ along the line relative to the A₁→A₂ step.
  </p>

  <!-- VISUALIZATION: Rotatable 3D collinear points -->
  <div class="viz-card">
    <div class="viz-header">
      <div class="viz-label">Fig. 1 — Collinear points in 3D space (drag to rotate)</div>
      <button class="viz-reset" onclick="resetView('plot-collinear')">↺ Reset View</button>
    </div>
    <div id="plot-collinear" style="height:380px;"></div>
    <div class="viz-caption">A₁ = (0,0,0), A₂ = (1,1,1), A₃ = (2,2,2) — a simple collinear triple along the main diagonal. The line continues through integer lattice points.</div>
  </div>
</div>

<!-- ════════════════ STEP A: QUADRANCE ════════════════ -->
<div class="section">
  <div class="section-header">
    <span class="step-number">Step A</span>
    <div class="section-title">Define Quadrance</div>
  </div>
  <div class="section-sub">Rational Trigonometry's squared-distance measure</div>

  <div class="def-card">
    <div class="def-term">Quadrance (Q)</div>
    <p>In Rational Trigonometry, we avoid square roots to keep everything <strong style="color:#ddd">rational</strong>. Instead of measuring distance — which often produces irrational numbers like √2 — we measure <em>Quadrance</em>: the <strong style="color:#ddd">square of the distance</strong>. Magnitude is defined not by how long a line is, but by the <strong style="color:#ddd">area of the square</strong> that line creates.</p>
    <div class="inline-formula">
      <span class="v">Q</span>(A,B) = (<span class="r">x_b − x_a</span>)² + (<span class="b">y_b − y_a</span>)² + (<span class="g">z_b − z_a</span>)²
    </div>
  </div>

  <!-- VISUALIZATION: Distance vs Quadrance comparison bar chart -->
  <div class="viz-card">
    <div class="viz-header">
      <div class="viz-label">Fig. 2 — Distance vs. Quadrance: why we prefer Q</div>
      <button class="viz-reset" onclick="resetView('plot-dist-vs-quad')">↺ Reset View</button>
    </div>
    <div id="plot-dist-vs-quad" style="height:320px;"></div>
    <div class="viz-caption">For lattice points with integer coordinates, distance often requires irrational square roots. Quadrance is always a rational integer — keeping the math clean.</div>
  </div>

  <p class="body-text" style="margin-top:24px;">For vector <span class="v"><strong>v = (dx, dy, dz)</strong></span>, the <strong>Base Quadrance</strong> is:</p>

  <div class="formula-hero">
    <span class="eq-label">Base Quadrance of v</span>
    <span class="v">Q<sub>v</sub></span> = <span class="r">dx²</span> + <span class="b">dy²</span> + <span class="g">dz²</span>
  </div>

  <p class="body-text">With A₂ = A₁ + v and A₃ = A₁ + kv, the three interaction quadrances between our points are:</p>

  <table class="q-table">
    <thead>
      <tr><th>Quadrance</th><th>Pair</th><th>Expression</th><th>Simplified</th></tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="qn q1">Q₁</span></td>
        <td style="font-family:'DM Mono',monospace;font-size:12px;color:#888">A₁ → A₂</td>
        <td style="font-family:'DM Mono',monospace;font-size:13px;color:#aaa">|v|² · 1²</td>
        <td style="font-family:'DM Mono',monospace;font-size:13px;color:#ddd">Q<sub>v</sub></td>
      </tr>
      <tr>
        <td><span class="qn q2">Q₂</span></td>
        <td style="font-family:'DM Mono',monospace;font-size:12px;color:#888">A₂ → A₃</td>
        <td style="font-family:'DM Mono',monospace;font-size:13px;color:#aaa">|v|² · (k−1)²</td>
        <td style="font-family:'DM Mono',monospace;font-size:13px;color:#ddd">(k−1)² · Q<sub>v</sub></td>
      </tr>
      <tr>
        <td><span class="qn q3">Q₃</span></td>
        <td style="font-family:'DM Mono',monospace;font-size:12px;color:#888">A₁ → A₃</td>
        <td style="font-family:'DM Mono',monospace;font-size:13px;color:#aaa">|v|² · k²</td>
        <td style="font-family:'DM Mono',monospace;font-size:13px;color:#ddd">k² · Q<sub>v</sub></td>
      </tr>
    </tbody>
  </table>

  <!-- VISUALIZATION: Quadrance as squares on a line -->
  <div class="viz-card">
    <div class="viz-header">
      <div class="viz-label">Fig. 3 — Quadrances as geometric areas along the line (k = 2)</div>
      <button class="viz-reset" onclick="resetView('plot-quadrance-areas')">↺ Reset View</button>
    </div>
    <div id="plot-quadrance-areas" style="height:300px;"></div>
    <div class="viz-caption">Each quadrance corresponds to the area of a square whose side equals the segment length. Q₁ = 1·Qv (red), Q₂ = (k−1)²·Qv (gold), Q₃ = k²·Qv (purple).</div>
  </div>
</div>

<!-- ════════════════ STEP B: SUBSTITUTION + LIVE SLIDER ════════════════ -->
<div class="section">
  <div class="section-header">
    <span class="step-number">Step B</span>
    <div class="section-title">Substitute & Verify Live</div>
  </div>
  <div class="section-sub">Drag k and watch LHS = RHS in real time</div>

  <p class="body-text">
    Setting Q<sub>v</sub> = 1 (the formula is homogeneous, so this is valid for the proof), we substitute Q₁ = 1, Q₂ = (k−1)², Q₃ = k² into both sides of the TQF. Drag the slider to verify the identity holds for any value of k.
  </p>

  <!-- INTERACTIVE K SLIDER -->
  <div class="slider-wrapper">
    <div class="slider-top">
      <label>Scalar <span>k</span> — position of A₃ along the line</label>
      <div class="k-display" id="k-display">2.00</div>
    </div>
    <input type="range" id="k-slider" min="0" max="4" step="0.01" value="2">
    <div class="q-readout">
      <div class="q-val qv1">
        <div class="q-name">Q₁</div>
        <div class="q-num" id="qval1">1.00</div>
      </div>
      <div class="q-val qv2">
        <div class="q-name">Q₂</div>
        <div class="q-num" id="qval2">1.00</div>
      </div>
      <div class="q-val qv3">
        <div class="q-name">Q₃</div>
        <div class="q-num" id="qval3">4.00</div>
      </div>
    </div>
    <div class="tqf-check">
      <span>LHS: <span class="lhs" id="lhs-val">(Q₁+Q₂+Q₃)² = 36.00</span></span>
      <span class="eq-sign">=</span>
      <span>RHS: <span class="rhs" id="rhs-val">2(Q₁²+Q₂²+Q₃²) = 36.00</span></span>
      <span class="status ok" id="tqf-status">✓ VERIFIED</span>
    </div>
  </div>

  <!-- VISUALIZATION: Live plot of LHS and RHS curves vs k -->
  <div class="viz-card">
    <div class="viz-header">
      <div class="viz-label">Fig. 4 — LHS and RHS of TQF as functions of k (the curves overlap perfectly)</div>
      <button class="viz-reset" onclick="resetView('plot-tqf-curves')">↺ Reset View</button>
    </div>
    <div id="plot-tqf-curves" style="height:340px;"></div>
    <div class="viz-caption">Both sides equal 4(k²−k+1)². The fact that a single polynomial describes both LHS and RHS is the heart of the proof. The vertical line tracks your slider value.</div>
  </div>
</div>

<!-- ════════════════ STEP C: ALGEBRAIC PROOF ════════════════ -->
<div class="section">
  <div class="section-header">
    <span class="step-number">Step C</span>
    <div class="section-title">The Algebraic Proof</div>
  </div>
  <div class="section-sub">Expanding both sides to confirm identity</div>

  <p class="body-text">With Q<sub>v</sub> = 1, we have Q₁ = 1, Q₂ = (k−1)², Q₃ = k². We now expand both sides independently and confirm they are equal.</p>

  <p style="color:var(--accent-blue); font-family:'DM Mono',monospace; font-size:12px; text-transform:uppercase; letter-spacing:0.1em; margin-bottom:12px;">Left Hand Side</p>
  <div class="proof-steps">
    <div class="proof-step">
      <div class="ps-label">Start</div>
      <div class="ps-body"><span>(Q₁ + Q₂ + Q₃)²</span></div>
    </div>
    <div class="proof-step" style="margin-top:2px">
      <div class="ps-label">Sub in</div>
      <div class="ps-body"><span>(1 + (k−1)² + k²)²</span><div class="ps-comment">substitute the quadrance expressions</div></div>
    </div>
    <div class="proof-step" style="margin-top:2px">
      <div class="ps-label">Expand</div>
      <div class="ps-body"><span>(1 + k² − 2k + 1 + k²)²</span><div class="ps-comment">expand (k−1)² = k² − 2k + 1</div></div>
    </div>
    <div class="proof-step" style="margin-top:2px">
      <div class="ps-label">Collect</div>
      <div class="ps-body"><span>(2k² − 2k + 2)²</span></div>
    </div>
    <div class="proof-step" style="margin-top:2px">
      <div class="ps-label">Factor</div>
      <div class="ps-body"><span style="color:var(--accent-violet)">4(k² − k + 1)²</span></div>
    </div>
  </div>

  <div style="text-align:center; margin:16px 0; color:var(--muted); font-family:'DM Mono',monospace; font-size:12px;">— — —</div>

  <p style="color:#a78bfa; font-family:'DM Mono',monospace; font-size:12px; text-transform:uppercase; letter-spacing:0.1em; margin-bottom:12px;">Right Hand Side</p>
  <div class="proof-steps">
    <div class="proof-step">
      <div class="ps-label">Start</div>
      <div class="ps-body"><span>2(Q₁² + Q₂² + Q₃²)</span></div>
    </div>
    <div class="proof-step" style="margin-top:2px">
      <div class="ps-label">Sub in</div>
      <div class="ps-body"><span>2(1 + (k−1)⁴ + k⁴)</span></div>
    </div>
    <div class="proof-step" style="margin-top:2px">
      <div class="ps-label">Expand</div>
      <div class="ps-body"><span>2(1 + k⁴ − 4k³ + 6k² − 4k + 1 + k⁴)</span><div class="ps-comment">expand (k−1)⁴ using binomial theorem</div></div>
    </div>
    <div class="proof-step" style="margin-top:2px">
      <div class="ps-label">Collect</div>
      <div class="ps-body"><span>2(2k⁴ − 4k³ + 6k² − 4k + 2)</span></div>
    </div>
    <div class="proof-step" style="margin-top:2px">
      <div class="ps-label">Simplify</div>
      <div class="ps-body"><span>4k⁴ − 8k³ + 12k² − 8k + 4</span></div>
    </div>
    <div class="proof-step" style="margin-top:2px">
      <div class="ps-label">Factor</div>
      <div class="ps-body"><span style="color:var(--accent-violet)">4(k² − k + 1)²</span></div>
    </div>
  </div>

  <div class="result-banner">
    <div class="res-label">QED — Proof Complete</div>
    <div class="res-text">Since LHS = RHS, the Triple Quad Formula holds for any three collinear points in 3D space, for all real k.</div>
    <div class="res-eq">4(k² − k + 1)² = 4(k² − k + 1)² ✓</div>
  </div>

  <!-- VISUALIZATION: The parabola 4(k²-k+1)² -->
  <div class="viz-card">
    <div class="viz-header">
      <div class="viz-label">Fig. 5 — The curve 4(k²−k+1)² — always positive, minimum at k=½</div>
      <button class="viz-reset" onclick="resetView('plot-parabola')">↺ Reset View</button>
    </div>
    <div id="plot-parabola" style="height:320px;"></div>
    <div class="viz-caption">This polynomial is always ≥ 3 and has its minimum at k = 0.5 (value = 3). The TQF is satisfied everywhere — no exceptions. The shaded region highlights the 4×4×4 lattice's valid k range of [0, 3].</div>
  </div>
</div>

<!-- ════════════════ APPLICATION: 4×4×4 LATTICE ════════════════ -->
<div class="section">
  <div class="section-header">
    <span class="step-number">App.</span>
    <div class="section-title">The 4×4×4 Lattice</div>
  </div>
  <div class="section-sub">SHD-CCP 64-bit packet — collinear triples in the grid</div>

  <p class="body-text">
    The 4×4×4 lattice consists of 64 nodes at integer coordinates in {0,1,2,3}³. Every collinear triple of these nodes satisfies the TQF — enabling rational distance analysis across the entire structure without any irrational numbers.
  </p>

  <div class="app-grid">
    <div class="app-card">
      <h4>Total Nodes</h4>
      <div class="app-val">4³ = 64</div>
      <p>Integer coordinates in {0,1,2,3}³</p>
    </div>
    <div class="app-card">
      <h4>Max Quadrance</h4>
      <div class="app-val">Q = 27</div>
      <p>Space diagonal (0,0,0)→(3,3,3): 9+9+9</p>
    </div>
    <div class="app-card">
      <h4>k range in lattice</h4>
      <div class="app-val">0 → 3</div>
      <p>k steps of 1 along any axis; diagonal steps are also integers</p>
    </div>
    <div class="app-card">
      <h4>Rational all the way</h4>
      <div class="app-val" style="font-size:15px; margin-top:6px;">No √ needed</div>
      <p>All quadrances between lattice points are integers</p>
    </div>
  </div>

  <!-- VISUALIZATION: 4x4x4 Lattice with collinear triple highlighted -->
  <div class="viz-card">
    <div class="viz-header">
      <div class="viz-label">Fig. 6 — The 4×4×4 lattice with a highlighted collinear triple (drag to rotate)</div>
      <button class="viz-reset" onclick="resetView('plot-lattice')">↺ Reset View</button>
    </div>
    <div id="plot-lattice" style="height:460px;"></div>
    <div class="viz-caption">All 64 nodes shown. The red→blue→green triple (0,0,0)→(1,1,1)→(2,2,2) is highlighted with connecting lines. Q₁=3, Q₂=3, Q₃=12 — verify: (3+3+12)²=324 = 2(9+9+144)=324 ✓</div>
  </div>
</div>

<!-- ════════════════ REFERENCES ════════════════ -->
<div class="refs">
  <h3>References &amp; Sources</h3>
  <a href="https://independent.academia.edu/GHoard" target="_blank">Garrett Hoard — Academia.edu Author Profile</a>
  <a href="https://www.academia.edu/164664471/Geometric_Compression_and_Branching_Dynamics_in_Discrete_3D_Lattices_The_Triple_Quad_4x4x4_System" target="_blank">Geometric Compression and Branching Dynamics in Discrete 3D Lattices: The Triple Quad 4×4×4 System</a>
  <a href="https://www.mdpi.com/1424-8220/22/21/8166" target="_blank">Graph Convolutional Network for 3D Object Pose Estimation in a Point Cloud — MDPI Sensors</a>
  <a href="https://research.math.osu.edu/tgda/mapperPBG.pdf" target="_blank">Topological Methods for the Analysis of High Dimensional Data Sets and 3D Object Recognition</a>
  <a href="https://www.cs.kuleuven.be/publicaties/doctoraten/tw/TW2007_05.pdf" target="_blank">Point Cloud Processing Using Linear Algebra and Graph Theory — KU Leuven</a>
</div>

</div><!-- end page-wrapper -->

<!-- ════════════════ SCRIPTS ════════════════ -->
<script>
// ── SHARED PLOTLY CONFIG ──────────────────────────────────────────
const DARK = {
  paper_bgcolor: '#0d0d16',
  plot_bgcolor:  '#0d0d16',
  font: { family: "'DM Mono', monospace", color: '#6a6a88', size: 11 },
  margin: { t: 20, b: 40, l: 50, r: 20 }
};

const AXIS_STYLE = {
  gridcolor: '#1e1e2e',
  zerolinecolor: '#2a2a3a',
  tickfont: { color: '#6a6a88', size: 10 },
  linecolor: '#2a2a3a'
};

function plotConfig(extra) {
  return Object.assign({
    displayModeBar: false,
    responsive: true
  }, extra || {});
}

// ── FIG 1: COLLINEAR POINTS IN 3D ────────────────────────────────
(function() {
  // lattice grid (faint)
  const gridX=[], gridY=[], gridZ=[];
  for(let x=0;x<4;x++) for(let y=0;y<4;y++) for(let z=0;z<4;z++) {
    gridX.push(x); gridY.push(y); gridZ.push(z);
  }

  const gridPoints = {
    type:'scatter3d', mode:'markers',
    x:gridX, y:gridY, z:gridZ,
    marker:{ size:2.5, color:'rgba(106,106,136,0.25)' },
    hoverinfo:'skip', name:'Lattice'
  };

  // the line
  const lineT = [];
  for(let t=-0.3;t<=3.3;t+=0.05) lineT.push(t);
  const theLine = {
    type:'scatter3d', mode:'lines',
    x:lineT, y:lineT, z:lineT,
    line:{ color:'rgba(192,132,252,0.3)', width:2 },
    hoverinfo:'skip', name:'Line'
  };

  // the three points
  const pts = {
    type:'scatter3d', mode:'markers+text',
    x:[0,1,2], y:[0,1,2], z:[0,1,2],
    marker:{ size:[10,10,10], color:['#f87171','#60a5fa','#4ade80'], line:{width:1,color:'#fff'} },
    text:['A₁','A₂','A₃'],
    textposition:'top center',
    textfont:{ size:12, color:'#fff' },
    name:'Points'
  };

  // vector arrows as lines
  const arr1 = { type:'scatter3d', mode:'lines', x:[0,1], y:[0,1], z:[0,1],
    line:{color:'#f87171',width:4}, hoverinfo:'skip', name:'v (A₁→A₂)' };
  const arr2 = { type:'scatter3d', mode:'lines', x:[1,2], y:[1,2], z:[1,2],
    line:{color:'#fb923c',width:4}, hoverinfo:'skip', name:'kv (A₂→A₃)' };

  Plotly.newPlot('plot-collinear', [gridPoints, theLine, arr1, arr2, pts], {
    ...DARK,
    scene:{
      xaxis:{...AXIS_STYLE, title:'x', range:[-0.5,3.5]},
      yaxis:{...AXIS_STYLE, title:'y', range:[-0.5,3.5]},
      zaxis:{...AXIS_STYLE, title:'z', range:[-0.5,3.5]},
      bgcolor:'#0d0d16',
      camera:{ eye:{x:1.6,y:1.6,z:0.9} },
      aspectmode:'cube'
    },
    showlegend: true,
    legend:{ x:0.01, y:0.99, bgcolor:'rgba(17,17,24,0.8)', bordercolor:'#2a2a3a', borderwidth:1,
             font:{color:'#888', size:10} }
  }, plotConfig());
})();


// ── FIG 2: DISTANCE vs QUADRANCE ─────────────────────────────────
(function() {
  const pairs = [
    {label:'(0,0)→(1,0)', dist:1,        q:1},
    {label:'(0,0)→(1,1)', dist:Math.sqrt(2), q:2},
    {label:'(0,0)→(2,1)', dist:Math.sqrt(5), q:5},
    {label:'(0,0)→(1,1,1)', dist:Math.sqrt(3), q:3},
    {label:'(0,0)→(2,2,1)', dist:3,       q:9},
    {label:'(0,0)→(3,3,3)', dist:Math.sqrt(27), q:27},
  ];

  const labels = pairs.map(p => p.label);
  const dists  = pairs.map(p => +p.dist.toFixed(4));
  const quads  = pairs.map(p => p.q);
  const isIrr  = pairs.map(p => !Number.isInteger(p.dist));

  const distColors = isIrr.map(b => b ? '#f87171' : '#60a5fa');

  const trDist = {
    type:'bar', name:'Distance', x:labels, y:dists,
    marker:{ color:distColors, opacity:0.85 },
    text: dists.map((d,i) => isIrr[i] ? '√'+pairs[i].q : ''+d),
    textposition:'outside',
    textfont:{ color:'#ccc', size:10 }
  };

  const trQuad = {
    type:'bar', name:'Quadrance', x:labels, y:quads,
    marker:{ color:'#a78bfa', opacity:0.85 },
    text: quads.map(q=>''+q),
    textposition:'outside',
    textfont:{ color:'#ccc', size:10 }
  };

  Plotly.newPlot('plot-dist-vs-quad', [trDist, trQuad], {
    ...DARK,
    barmode:'group',
    xaxis:{ ...AXIS_STYLE, tickangle:-20, tickfont:{size:9,color:'#666'} },
    yaxis:{ ...AXIS_STYLE, title:'Value' },
    showlegend:true,
    legend:{ x:0.01, y:0.99, bgcolor:'rgba(17,17,24,0.8)', bordercolor:'#2a2a3a', borderwidth:1,
             font:{color:'#888',size:10} },
    annotations:[{
      x:1, y: dists[1]+0.15,
      text:'Irrational ≈'+dists[1], showarrow:false,
      font:{color:'#f87171',size:9}
    }]
  }, plotConfig());
})();


// ── FIG 3: QUADRANCE AS AREAS ─────────────────────────────────────
(function() {
  const k = 2;
  // Represent Q1, Q2, Q3 as squares on the number line
  // positions: 0, 1, k along the line
  // segment lengths: 1, k-1, k  => quadrances: 1, (k-1)^2, k^2
  const Q1 = 1, Q2 = (k-1)**2, Q3 = k**2;
  const segs = [
    { label:'Q₁ = 1', start:0, end:1, color:'#a3e635', q:Q1 },
    { label:'Q₂ = (k−1)² = '+Q2, start:1, end:k, color:'#fbbf24', q:Q2 },
    { label:'Q₃ = k² = '+Q3, start:0, end:k, color:'#a78bfa', q:Q3 }
  ];

  const shapes = [];
  const annotations = [];

  // Draw line
  const lineTrace = {
    type:'scatter', mode:'lines+markers',
    x:[0, 1, 2], y:[0,0,0],
    line:{color:'rgba(255,255,255,0.3)',width:2},
    marker:{size:[12,12,12], color:['#f87171','#60a5fa','#4ade80'], line:{width:1,color:'#fff'}},
    text:['A₁ (0)','A₂ (1)','A₃ (k=2)'],
    hoverinfo:'text',
    showlegend:false
  };

  const yOffsets = [0.5, 1.6, 2.9];
  const bars = segs.map((s, i) => ({
    type:'bar',
    name: s.label,
    x: [(s.start+s.end)/2],
    y: [s.q],
    width: [s.end-s.start],
    base:[0],
    marker:{ color: s.color+'33', line:{color:s.color, width:2} },
    offset:[0],
    showlegend:true
  }));

  // Simpler: horizontal stacked area chart showing Q values
  const trace_q1 = {
    type:'bar', name:'Q₁ = 1 (A₁→A₂)', x:['Q₁','Q₂','Q₃'], y:[Q1, Q2, Q3],
    marker:{
      color:['#a3e63588','#fbbf2488','#a78bfa88'],
      line:{color:['#a3e635','#fbbf24','#a78bfa'], width:2}
    },
    text:['Q₁ = '+Q1, 'Q₂ = '+Q2, 'Q₃ = '+Q3],
    textposition:'outside',
    textfont:{color:'#ddd', size:12}
  };

  Plotly.newPlot('plot-quadrance-areas', [trace_q1], {
    ...DARK,
    xaxis:{ ...AXIS_STYLE, tickfont:{size:13,color:'#ccc'} },
    yaxis:{ ...AXIS_STYLE, title:'Quadrance value (Qv = 1)', range:[0, 6] },
    showlegend: false,
    annotations:[
      {x:'Q₁', y:Q1+0.3, text:'A₁→A₂<br>length=1<br>Q=1²=1', showarrow:false, font:{color:'#a3e635',size:10}, align:'center'},
      {x:'Q₂', y:Q2+0.3, text:'A₂→A₃<br>length=(k−1)=1<br>Q=1²=1', showarrow:false, font:{color:'#fbbf24',size:10}, align:'center'},
      {x:'Q₃', y:Q3+0.3, text:'A₁→A₃<br>length=k=2<br>Q=2²=4', showarrow:false, font:{color:'#a78bfa',size:10}, align:'center'},
    ]
  }, plotConfig());
})();


// ── FIG 4 + SLIDER: TQF CURVES ───────────────────────────────────
let kLine;
(function() {
  const ks = [];
  for(let k=-0.5; k<=4.5; k+=0.02) ks.push(+k.toFixed(3));

  const lhsVals = ks.map(k => {
    const q1=1, q2=(k-1)**2, q3=k**2;
    return (q1+q2+q3)**2;
  });
  const rhsVals = ks.map(k => {
    const q1=1, q2=(k-1)**2, q3=k**2;
    return 2*(q1**2+q2**2+q3**2);
  });

  const traceLHS = {
    type:'scatter', mode:'lines', name:'LHS = (Q₁+Q₂+Q₃)²',
    x:ks, y:lhsVals,
    line:{color:'#a3e635', width:3}
  };
  const traceRHS = {
    type:'scatter', mode:'lines', name:'RHS = 2(Q₁²+Q₂²+Q₃²)',
    x:ks, y:rhsVals,
    line:{color:'#a78bfa', width:2, dash:'dot'}
  };

  // vertical line at k=2
  const kVal = 2;
  const curLHS = (1+(kVal-1)**2+kVal**2)**2;
  kLine = {
    type:'scatter', mode:'lines+markers', name:'current k',
    x:[kVal, kVal], y:[0, curLHS+20],
    line:{color:'#fb923c', width:1.5, dash:'dash'},
    marker:{size:[0,8], color:'#fb923c'},
    hoverinfo:'skip'
  };

  Plotly.newPlot('plot-tqf-curves', [traceLHS, traceRHS, kLine], {
    ...DARK,
    xaxis:{ ...AXIS_STYLE, title:'k', range:[-0.5,4.5] },
    yaxis:{ ...AXIS_STYLE, title:'Value', range:[-10, 250] },
    showlegend:true,
    legend:{ x:0.01, y:0.99, bgcolor:'rgba(17,17,24,0.8)', bordercolor:'#2a2a3a', borderwidth:1,
             font:{color:'#888',size:10} }
  }, plotConfig());
})();


// ── SLIDER LOGIC ─────────────────────────────────────────────────
const slider    = document.getElementById('k-slider');
const kDisplay  = document.getElementById('k-display');
const q1El = document.getElementById('qval1');
const q2El = document.getElementById('qval2');
const q3El = document.getElementById('qval3');
const lhsEl = document.getElementById('lhs-val');
const rhsEl = document.getElementById('rhs-val');
const statusEl = document.getElementById('tqf-status');

function updateSlider() {
  const k = parseFloat(slider.value);
  const q1 = 1;
  const q2 = (k-1)**2;
  const q3 = k**2;
  const lhs = (q1+q2+q3)**2;
  const rhs = 2*(q1**2+q2**2+q3**2);

  kDisplay.textContent = k.toFixed(2);
  q1El.textContent = q1.toFixed(2);
  q2El.textContent = q2.toFixed(2);
  q3El.textContent = q3.toFixed(2);
  lhsEl.textContent = `(Q₁+Q₂+Q₃)² = ${lhs.toFixed(2)}`;
  rhsEl.textContent = `2(Q₁²+Q₂²+Q₃²) = ${rhs.toFixed(2)}`;

  const ok = Math.abs(lhs - rhs) < 0.001;
  statusEl.textContent = ok ? '✓ VERIFIED' : '✗ ERROR';
  statusEl.className = 'status ' + (ok ? 'ok' : 'bad');

  // update vertical line in fig 4
  const yTop = lhs + 20;
  Plotly.restyle('plot-tqf-curves', { x:[[k,k]], y:[[0, yTop]] }, [2]);
}

slider.addEventListener('input', updateSlider);
updateSlider();


// ── FIG 5: THE PARABOLA 4(k²-k+1)² ──────────────────────────────
(function() {
  const ks = [];
  for(let k=-1; k<=5; k+=0.02) ks.push(+k.toFixed(3));
  const vals = ks.map(k => 4*(k*k - k + 1)**2);

  const curve = {
    type:'scatter', mode:'lines', name:'4(k²−k+1)²',
    x:ks, y:vals,
    line:{color:'#c084fc', width:3},
    fill:'tozeroy',
    fillcolor:'rgba(192,132,252,0.06)'
  };

  // highlight lattice range [0,3]
  const ksLattice = [];
  for(let k=0; k<=3; k+=0.02) ksLattice.push(+k.toFixed(3));
  const valsLattice = ksLattice.map(k => 4*(k*k-k+1)**2);

  const latticeRange = {
    type:'scatter', mode:'none', name:'4×4×4 k range [0,3]',
    x:[...ksLattice, ...ksLattice.slice().reverse()],
    y:[...valsLattice, ...valsLattice.map(()=>0)],
    fill:'toself', fillcolor:'rgba(251,191,36,0.07)',
    line:{color:'rgba(251,191,36,0.3)', width:1}
  };

  // minimum point
  const minPt = {
    type:'scatter', mode:'markers+text',
    x:[0.5], y:[3],
    marker:{size:10, color:'#fbbf24', line:{width:1,color:'#fff'}},
    text:['min = 3 at k=½'],
    textposition:'top right',
    textfont:{color:'#fbbf24', size:10},
    name:'Minimum'
  };

  Plotly.newPlot('plot-parabola', [latticeRange, curve, minPt], {
    ...DARK,
    xaxis:{ ...AXIS_STYLE, title:'k', range:[-1,5] },
    yaxis:{ ...AXIS_STYLE, title:'4(k²−k+1)²', range:[-5, 500] },
    showlegend:true,
    legend:{ x:0.01, y:0.99, bgcolor:'rgba(17,17,24,0.8)', bordercolor:'#2a2a3a', borderwidth:1,
             font:{color:'#888',size:10} }
  }, plotConfig());
})();


// ── FIG 6: 4×4×4 LATTICE ─────────────────────────────────────────
(function() {
  const allX=[], allY=[], allZ=[];
  for(let x=0;x<4;x++) for(let y=0;y<4;y++) for(let z=0;z<4;z++) {
    // skip the highlighted triple
    if(!((x===y&&y===z)&&x<=2)) { allX.push(x); allY.push(y); allZ.push(z); }
  }

  const lattice = {
    type:'scatter3d', mode:'markers', name:'Lattice nodes',
    x:allX, y:allY, z:allZ,
    marker:{ size:3, color:'rgba(106,106,136,0.4)', line:{width:0} },
    hovertemplate:'(%{x},%{y},%{z})<extra></extra>'
  };

  // collinear triple (0,0,0), (1,1,1), (2,2,2)
  const triplePoints = {
    type:'scatter3d', mode:'markers+text', name:'Collinear triple',
    x:[0,1,2], y:[0,1,2], z:[0,1,2],
    marker:{ size:[12,12,12], color:['#f87171','#60a5fa','#4ade80'], line:{width:2,color:'#fff'} },
    text:['A₁<br>Q₁=3','A₂<br>Q₂=3','A₃<br>Q₃=12'],
    textposition:['top left','top center','top right'],
    textfont:{ size:11, color:'#fff' }
  };

  // connecting line extended
  const lineT2 = [];
  for(let t=-0.1;t<=2.5;t+=0.05) lineT2.push(t);
  const connectLine = {
    type:'scatter3d', mode:'lines', name:'Line through triple',
    x:lineT2, y:lineT2, z:lineT2,
    line:{color:'rgba(192,132,252,0.5)',width:3},
    hoverinfo:'skip'
  };

  // axis lines for context
  const edges = [];
  const corners = [[0,0,0],[3,0,0],[0,3,0],[0,0,3],[3,3,0],[3,0,3],[0,3,3],[3,3,3]];
  const edgePairs = [[0,1],[0,2],[0,3],[1,4],[1,5],[2,4],[2,6],[3,5],[3,6],[4,7],[5,7],[6,7]];
  edgePairs.forEach(([a,b]) => {
    edges.push({
      type:'scatter3d', mode:'lines',
      x:[corners[a][0],corners[b][0]], y:[corners[a][1],corners[b][1]], z:[corners[a][2],corners[b][2]],
      line:{color:'rgba(42,42,58,0.8)',width:1},
      hoverinfo:'skip', showlegend:false
    });
  });

  Plotly.newPlot('plot-lattice', [...edges, lattice, connectLine, triplePoints], {
    ...DARK,
    margin:{t:10, b:10, l:10, r:10},
    scene:{
      xaxis:{...AXIS_STYLE, title:'x', range:[-0.3,3.3], dtick:1},
      yaxis:{...AXIS_STYLE, title:'y', range:[-0.3,3.3], dtick:1},
      zaxis:{...AXIS_STYLE, title:'z', range:[-0.3,3.3], dtick:1},
      bgcolor:'#0d0d16',
      camera:{ eye:{x:1.8,y:1.5,z:1.0} },
      aspectmode:'cube'
    },
    showlegend:true,
    legend:{ x:0.01, y:0.99, bgcolor:'rgba(17,17,24,0.85)', bordercolor:'#2a2a3a', borderwidth:1,
             font:{color:'#888',size:10} }
  }, plotConfig());
})();


// ── RESET VIEW ────────────────────────────────────────────────────
// Default camera / axis states for each plot
const DEFAULT_VIEWS = {
  'plot-collinear': {
    scene: { camera: { eye: { x: 1.6, y: 1.6, z: 0.9 } } }
  },
  'plot-dist-vs-quad': {
    'xaxis.autorange': true,
    'yaxis.autorange': true
  },
  'plot-quadrance-areas': {
    'xaxis.autorange': true,
    'yaxis.range': [0, 6],
    'yaxis.autorange': false
  },
  'plot-tqf-curves': {
    'xaxis.range': [-0.5, 4.5],
    'xaxis.autorange': false,
    'yaxis.range': [-10, 250],
    'yaxis.autorange': false
  },
  'plot-parabola': {
    'xaxis.range': [-1, 5],
    'xaxis.autorange': false,
    'yaxis.range': [-5, 500],
    'yaxis.autorange': false
  },
  'plot-lattice': {
    scene: { camera: { eye: { x: 1.8, y: 1.5, z: 1.0 } } }
  }
};

function resetView(id) {
  const update = DEFAULT_VIEWS[id];
  if (!update) return;
  Plotly.relayout(id, update);

  // Brief visual flash on the button for feedback
  const btn = document.querySelector(`button[onclick="resetView('${id}')"]`);
  if (btn) {
    btn.textContent = '✓ Reset';
    btn.style.color = 'var(--accent-green)';
    btn.style.borderColor = 'rgba(74,222,128,0.5)';
    setTimeout(() => {
      btn.textContent = '↺ Reset View';
      btn.style.color = '';
      btn.style.borderColor = '';
    }, 600);
  }
}
</script>
</body>
</html>
